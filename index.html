<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ingenico Lane 3600 - 360° View</title>
    
    <!-- Open Graph meta tags -->
    <meta property="og:type" content="video.other">
    <meta property="og:title" content="Ingenico Lane 3600 - 360° View">
    <meta property="og:description" content="Interactive 360° product viewer">
    <meta property="og:site_name" content="Product 360 Viewer">
    <meta property="og:url" content="https://john-github-tests.github.io/spin-embed/">
    <meta property="og:video" content="https://john-github-tests.github.io/spin-embed/">
    <meta property="og:video:type" content="text/html">
    <meta property="og:video:width" content="800">
    <meta property="og:video:height" content="600">
    
    <!-- Twitter Player Card -->
    <meta name="twitter:card" content="player">
    <meta name="twitter:title" content="Ingenico Lane 3600 - 360° View">
    <meta name="twitter:description" content="Interactive 360° product viewer">
    <meta name="twitter:player" content="https://john-github-tests.github.io/spin-embed/">
    <meta name="twitter:player:width" content="800">
    <meta name="twitter:player:height" content="600">
    
    <!-- iframely player link -->
    <link rel="iframely player" type="text/html" href="https://john-github-tests.github.io/spin-embed/" media="aspect-ratio: 1.333">
    <link rel="alternate" type="application/json+oembed" href="https://john-github-tests.github.io/spin-embed/oembed.json" title="Ingenico Lane 3600 - 360° View">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }
        
        .viewer-wrapper {
            position: relative;
            width: 100%;
            max-width: 100%;
            height: 100vh;
            cursor: grab;
            user-select: none;
            -webkit-user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .viewer-wrapper:active {
            cursor: grabbing;
        }
        
        .viewer-wrapper img {
            width: auto;
            height: auto;
            max-width: 100%;
            max-height: 100%;
            display: block;
        }
        
        .loading {
            text-align: center;
            padding: 50px 20px;
            color: #999;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        .spinner {
            border: 3px solid #f0f0f0;
            border-top: 3px solid #666;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .progress-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: #f0f0f0;
        }
        
        .progress-fill {
            height: 100%;
            background: #666;
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div id="viewer" class="loading">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>
    
    <div class="progress-bar" id="progressBar" style="display: none;">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            totalFrames: 60,
            // Option 1: Frames in same directory as index.html
            framePathTemplate: 'frames/frame_{index}.png',
            
            // Option 2: Frames hosted on CDN (uncomment and update URL)
            // framePathTemplate: 'https://your-cdn.com/lane3600/frame_{index}.png',
            
            friction: 0.92,        // Momentum friction (0-1, higher = more momentum)
            sensitivity: 0.5       // Drag sensitivity
        };

        class Product360Viewer {
            constructor(container, config) {
                this.container = container;
                this.config = config;
                this.currentFrame = 0;
                this.images = [];
                this.isLoaded = false;
                this.isDragging = false;
                this.startX = 0;
                this.lastX = 0;
                this.velocity = 0;
                this.animationFrame = null;
                
                this.init();
            }
            
            init() {
                this.preloadImages();
            }
            
            getFramePath(index) {
                const paddedIndex = String(index).padStart(3, '0');
                return this.config.framePathTemplate.replace('{index}', paddedIndex);
            }
            
            async preloadImages() {
                const progressBar = document.getElementById('progressBar');
                const progressFill = document.getElementById('progressFill');
                progressBar.style.display = 'block';
                
                let loaded = 0;
                const updateProgress = () => {
                    const percent = (loaded / this.config.totalFrames) * 100;
                    progressFill.style.width = percent + '%';
                };
                
                // Load all images
                const promises = [];
                for (let i = 0; i < this.config.totalFrames; i++) {
                    const promise = new Promise((resolve, reject) => {
                        const img = new Image();
                        img.onload = () => {
                            loaded++;
                            updateProgress();
                            resolve(img);
                        };
                        img.onerror = () => reject(`Failed to load frame ${i}`);
                        img.src = this.getFramePath(i);
                    });
                    promises.push(promise);
                }
                
                try {
                    this.images = await Promise.all(promises);
                    this.render();
                } catch (error) {
                    console.error('Error loading images:', error);
                    this.container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #d9534f;">
                            <p>⚠️ Error loading 360° viewer</p>
                            <p style="font-size: 12px; margin-top: 10px;">Please check that frames are uploaded correctly.</p>
                        </div>
                    `;
                }
            }
            
            render() {
                // Create viewer wrapper
                this.wrapper = document.createElement('div');
                this.wrapper.className = 'viewer-wrapper';
                
                // Add first image
                this.imageElement = this.images[0].cloneNode();
                this.wrapper.appendChild(this.imageElement);
                
                // Replace loading state
                this.container.innerHTML = '';
                this.container.appendChild(this.wrapper);
                
                // Hide progress bar
                document.getElementById('progressBar').style.display = 'none';
                
                this.isLoaded = true;
                this.addEventListeners();
            }
            
            addEventListeners() {
                // Mouse events
                this.wrapper.addEventListener('mousedown', this.onDragStart.bind(this));
                document.addEventListener('mousemove', this.onDragMove.bind(this));
                document.addEventListener('mouseup', this.onDragEnd.bind(this));
                
                // Touch events
                this.wrapper.addEventListener('touchstart', this.onDragStart.bind(this));
                document.addEventListener('touchmove', this.onDragMove.bind(this));
                document.addEventListener('touchend', this.onDragEnd.bind(this));
                
                // Prevent default drag behavior
                this.wrapper.addEventListener('dragstart', (e) => e.preventDefault());
            }
            
            onDragStart(e) {
                this.isDragging = true;
                this.velocity = 0;
                const x = e.type.includes('mouse') ? e.pageX : e.touches[0].pageX;
                this.startX = x;
                this.lastX = x;
                
                if (this.animationFrame) {
                    cancelAnimationFrame(this.animationFrame);
                }
            }
            
            onDragMove(e) {
                if (!this.isDragging) return;
                
                e.preventDefault();
                const x = e.type.includes('mouse') ? e.pageX : e.touches[0].pageX;
                const deltaX = x - this.lastX;
                
                this.velocity = deltaX;
                this.updateFrame(deltaX * this.config.sensitivity);
                this.lastX = x;
            }
            
            onDragEnd() {
                if (!this.isDragging) return;
                this.isDragging = false;
                this.applyMomentum();
            }
            
            applyMomentum() {
                if (Math.abs(this.velocity) < 0.5) {
                    this.velocity = 0;
                    return;
                }
                
                this.updateFrame(this.velocity * this.config.sensitivity);
                this.velocity *= this.config.friction;
                
                this.animationFrame = requestAnimationFrame(() => this.applyMomentum());
            }
            
            updateFrame(delta) {
                // Negate delta to reverse spin direction
                const frameDelta = Math.round(-delta / 10);
                this.currentFrame = (this.currentFrame + frameDelta + this.config.totalFrames) % this.config.totalFrames;
                this.imageElement.src = this.images[this.currentFrame].src;
            }
        }
        
        // Initialize viewer
        document.addEventListener('DOMContentLoaded', () => {
            const viewer = new Product360Viewer(
                document.getElementById('viewer'),
                CONFIG
            );
        });
    </script>
</body>
</html>
